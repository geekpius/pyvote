{% load static %}
<table id="programmeDataTable" class="table table-bordered table-striped">
    <thead>
        <tr>
            <th>Programme</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody>
        {% for programme in programme_list %}
        <tr class="record">
            <td>{{programme.name|title}}</td>
            <td>
                <a href="{% url 'voters:programme_delete' programme.id %}" title="Delete {{ programme.name|title }}" class="btn_delete"><i class="fa fa-trash text-danger fa-lg"></i></a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>


<script>
    $("#programmeDataTable").DataTable();

    // delete programme
    $("#programmeDataTable tbody").on('click', '.btn_delete', function(e){
        e.preventDefault();
        e.stopPropagation();
        var $this = $(this);
        swal({
            title: "Sure to delete?",
            text: "This action is irreversible",
            type: "warning",
            showCancelButton: true,
            confirmButtonClass: "btn-danger btn-sm",
            cancelButtonClass: "btn-sm",
            confirmButtonText: "Yes, delete",
            closeOnConfirm: true
            },
        function(){
            $.ajax({
                url: $this.attr('href'),
                type: "GET",
                dataType: "json",
                success: function(response){
                    if(response.message=='success'){
                        $this.parents('.record').fadeOut('slow', function(){
                            $this.parents('.record').remove();
                        });
                    }else{
                        console.log("something went wrong");
                    }
                },
                error: function(response){
                    console.log('something wrong with request')
                }
            });
        });
        return false;
    });

</script>